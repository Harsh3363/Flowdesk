{"version":3,"file":"tambo-v1-stream-context.test.js","sourceRoot":"","sources":["../../../src/v1/providers/tambo-v1-stream-context.test.tsx"],"names":[],"mappings":";;;;;AAAA,sCAA8D;AAC9D,kDAAyD;AACzD,kDAA0B;AAC1B,uEAImC;AAEnC,QAAQ,CAAC,uBAAuB,EAAE,GAAG,EAAE;IACrC,QAAQ,CAAC,gBAAgB,EAAE,GAAG,EAAE;QAC9B,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;YAC3C,4CAA4C;YAC5C,MAAM,UAAU,GAAG,IAAI;iBACpB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC;iBACvB,kBAAkB,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;YAEhC,MAAM,CAAC,GAAG,EAAE;gBACV,IAAA,kBAAU,EAAC,GAAG,EAAE,CAAC,IAAA,wCAAc,GAAE,CAAC,CAAC;YACrC,CAAC,CAAC,CAAC,OAAO,CAAC,0DAA0D,CAAC,CAAC;YAEvE,UAAU,CAAC,WAAW,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,6DAA6D,EAAE,GAAG,EAAE;YACrE,MAAM,OAAO,GAAG,CAAC,EAAE,QAAQ,EAAiC,EAAE,EAAE,CAAC,CAC/D,8BAAC,+CAAqB,QAAE,QAAQ,CAAyB,CAC1D,CAAC;YAEF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,kBAAU,EAAC,GAAG,EAAE,CAAC,IAAA,wCAAc,GAAE,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;YAEnE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;YAC7C,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,QAAQ,EAAE,CAAC;QACpD,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,8CAA8C,EAAE,GAAG,EAAE;YACtD,MAAM,OAAO,GAAG,CAAC,EAAE,QAAQ,EAAiC,EAAE,EAAE,CAAC,CAC/D,8BAAC,+CAAqB,IAAC,QAAQ,EAAC,YAAY,IACzC,QAAQ,CACa,CACzB,CAAC;YAEF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,kBAAU,EAAC,GAAG,EAAE,CAAC,IAAA,wCAAc,GAAE,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;YAEnE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC1D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,CAAC,WAAW,EAAE,CAAC;YAC1D,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACzE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;YACvE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,EAAE,CAAC,CAAC;QAC1E,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,yCAAyC,EAAE,GAAG,EAAE;YACjD,MAAM,OAAO,GAAG,CAAC,EAAE,QAAQ,EAAiC,EAAE,EAAE,CAAC,CAC/D,8BAAC,+CAAqB,IACpB,QAAQ,EAAC,YAAY,EACrB,aAAa,EAAE;oBACb,KAAK,EAAE,aAAa;oBACpB,QAAQ,EAAE,EAAE,GAAG,EAAE,OAAO,EAAE;iBAC3B,IAEA,QAAQ,CACa,CACzB,CAAC;YAEF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,kBAAU,EAAC,GAAG,EAAE,CAAC,IAAA,wCAAc,GAAE,EAAE,EAAE,OAAO,EAAE,CAAC,CAAC;YAEnE,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,IAAI,CAC3D,aAAa,CACd,CAAC;YACF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC;gBAClE,GAAG,EAAE,OAAO;aACb,CAAC,CAAC;YACH,qCAAqC;YACrC,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;QACzE,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;IAEH,QAAQ,CAAC,mBAAmB,EAAE,GAAG,EAAE;QACjC,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;YAC3C,MAAM,UAAU,GAAG,IAAI;iBACpB,KAAK,CAAC,OAAO,EAAE,OAAO,CAAC;iBACvB,kBAAkB,CAAC,GAAG,EAAE,GAAE,CAAC,CAAC,CAAC;YAEhC,MAAM,CAAC,GAAG,EAAE;gBACV,IAAA,kBAAU,EAAC,GAAG,EAAE,CAAC,IAAA,2CAAiB,GAAE,CAAC,CAAC;YACxC,CAAC,CAAC,CAAC,OAAO,CAAC,6DAA6D,CAAC,CAAC;YAE1E,UAAU,CAAC,WAAW,EAAE,CAAC;QAC3B,CAAC,CAAC,CAAC;QAEH,EAAE,CAAC,mCAAmC,EAAE,GAAG,EAAE;YAC3C,MAAM,OAAO,GAAG,CAAC,EAAE,QAAQ,EAAiC,EAAE,EAAE,CAAC,CAC/D,8BAAC,+CAAqB,IAAC,QAAQ,EAAC,YAAY,IACzC,QAAQ,CACa,CACzB,CAAC;YAEF,MAAM,EAAE,MAAM,EAAE,GAAG,IAAA,kBAAU,EAC3B,GAAG,EAAE,CAAC,CAAC;gBACL,KAAK,EAAE,IAAA,wCAAc,GAAE;gBACvB,QAAQ,EAAE,IAAA,2CAAiB,GAAE;aAC9B,CAAC,EACF,EAAE,OAAO,EAAE,CACZ,CAAC;YAEF,MAAM,eAAe,GAAoB;gBACvC,IAAI,EAAE,gBAAS,CAAC,WAAW;gBAC3B,KAAK,EAAE,OAAO;gBACd,QAAQ,EAAE,YAAY;aACvB,CAAC;YAEF,IAAA,WAAG,EAAC,GAAG,EAAE;gBACP,MAAM,CAAC,OAAO,CAAC,QAAQ,CAAC;oBACtB,IAAI,EAAE,OAAO;oBACb,KAAK,EAAE,eAAe;oBACtB,QAAQ,EAAE,YAAY;iBACvB,CAAC,CAAC;YACL,CAAC,CAAC,CAAC;YAEH,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,IAAI,CAClE,WAAW,CACZ,CAAC;YACF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,MAAM,CAAC,CAAC,IAAI,CACrE,WAAW,CACZ,CAAC;YACF,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,SAAS,CAAC,UAAU,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,IAAI,CACpE,OAAO,CACR,CAAC;QACJ,CAAC,CAAC,CAAC;IACL,CAAC,CAAC,CAAC;AACL,CAAC,CAAC,CAAC","sourcesContent":["import { EventType, type RunStartedEvent } from \"@ag-ui/core\";\nimport { renderHook, act } from \"@testing-library/react\";\nimport React from \"react\";\nimport {\n  TamboV1StreamProvider,\n  useStreamState,\n  useStreamDispatch,\n} from \"./tambo-v1-stream-context\";\n\ndescribe(\"TamboV1StreamProvider\", () => {\n  describe(\"useStreamState\", () => {\n    it(\"throws when used outside provider\", () => {\n      // Suppress console.error for expected error\n      const consoleSpy = jest\n        .spyOn(console, \"error\")\n        .mockImplementation(() => {});\n\n      expect(() => {\n        renderHook(() => useStreamState());\n      }).toThrow(\"useStreamState must be used within TamboV1StreamProvider\");\n\n      consoleSpy.mockRestore();\n    });\n\n    it(\"returns initial state with empty threadMap when no threadId\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider>{children}</TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(() => useStreamState(), { wrapper });\n\n      expect(result.current.threadMap).toEqual({});\n      expect(result.current.currentThreadId).toBeNull();\n    });\n\n    it(\"initializes thread when threadId is provided\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider threadId=\"thread_123\">\n          {children}\n        </TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(() => useStreamState(), { wrapper });\n\n      expect(result.current.currentThreadId).toBe(\"thread_123\");\n      expect(result.current.threadMap.thread_123).toBeDefined();\n      expect(result.current.threadMap.thread_123.thread.id).toBe(\"thread_123\");\n      expect(result.current.threadMap.thread_123.thread.status).toBe(\"idle\");\n      expect(result.current.threadMap.thread_123.thread.messages).toEqual([]);\n    });\n\n    it(\"merges initialThread with default state\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider\n          threadId=\"thread_123\"\n          initialThread={{\n            title: \"Test Thread\",\n            metadata: { key: \"value\" },\n          }}\n        >\n          {children}\n        </TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(() => useStreamState(), { wrapper });\n\n      expect(result.current.threadMap.thread_123.thread.title).toBe(\n        \"Test Thread\",\n      );\n      expect(result.current.threadMap.thread_123.thread.metadata).toEqual({\n        key: \"value\",\n      });\n      // Default values should still be set\n      expect(result.current.threadMap.thread_123.thread.status).toBe(\"idle\");\n    });\n  });\n\n  describe(\"useStreamDispatch\", () => {\n    it(\"throws when used outside provider\", () => {\n      const consoleSpy = jest\n        .spyOn(console, \"error\")\n        .mockImplementation(() => {});\n\n      expect(() => {\n        renderHook(() => useStreamDispatch());\n      }).toThrow(\"useStreamDispatch must be used within TamboV1StreamProvider\");\n\n      consoleSpy.mockRestore();\n    });\n\n    it(\"dispatches events to update state\", () => {\n      const wrapper = ({ children }: { children: React.ReactNode }) => (\n        <TamboV1StreamProvider threadId=\"thread_123\">\n          {children}\n        </TamboV1StreamProvider>\n      );\n\n      const { result } = renderHook(\n        () => ({\n          state: useStreamState(),\n          dispatch: useStreamDispatch(),\n        }),\n        { wrapper },\n      );\n\n      const runStartedEvent: RunStartedEvent = {\n        type: EventType.RUN_STARTED,\n        runId: \"run_1\",\n        threadId: \"thread_123\",\n      };\n\n      act(() => {\n        result.current.dispatch({\n          type: \"EVENT\",\n          event: runStartedEvent,\n          threadId: \"thread_123\",\n        });\n      });\n\n      expect(result.current.state.threadMap.thread_123.thread.status).toBe(\n        \"streaming\",\n      );\n      expect(result.current.state.threadMap.thread_123.streaming.status).toBe(\n        \"streaming\",\n      );\n      expect(result.current.state.threadMap.thread_123.streaming.runId).toBe(\n        \"run_1\",\n      );\n    });\n  });\n});\n"]}